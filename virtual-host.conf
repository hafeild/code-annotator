<VirtualHost *:80>
  ServerName annotate.feild.org 
  #ServerAlias domain.com

  # Point this to your public folder of teambox
  DocumentRoot /home/hfeild/online-source-code-annotator/public

  RewriteEngine On

  <Proxy balancer://unicornservers>
    BalancerMember http://127.0.0.1:5000
  </Proxy>

  # Redirect all non-static requests to thin
  RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f
  RewriteRule ^/(.*)$ balancer://unicornservers%{REQUEST_URI} [P,QSA,L]

  ProxyPass / balancer://unicornservers/
  ProxyPassReverse / balancer://unicornservers/
  ProxyPreserveHost on

  <Proxy *>
    Order deny,allow
    Allow from all
  </Proxy>

  # Custom log file locations
  ErrorLog  /home/hfeild/online-source-code-annotator/log/error.log
  CustomLog /home/hfeild/online-source-code-annotator/log/access.log combined

</VirtualHost>


## For SSL:
<VirtualHost *:443>
  ServerName annotate.feild.org
  SSLEngine on
  SSLCertificateFile <REPLACE WITH CERT LOCATION>
  SSLCertificateKeyFile <REPLACE WITH KEY LOCATION>
  SSLCertificateChainFile <REPLACE WITH PEM FILE>

  #ServerAlias domain.com

  # Point this to your public folder of teambox
  DocumentRoot /home/hfeild/online-source-code-annotator/public

  RewriteEngine On

  <Proxy balancer://unicornservers>
    BalancerMember http://127.0.0.1:5000
  </Proxy>

  # Redirect all non-static requests to thin
  RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f
  RewriteRule ^/(.*)$ balancer://unicornservers%{REQUEST_URI} [P,QSA,L]
  RequestHeader set X-Forwarded-Proto "https"

  ProxyPass / balancer://unicornservers/
  ProxyPassReverse / balancer://unicornservers/
  ProxyPreserveHost on

  <Proxy *>
    Order deny,allow
    Allow from all
  </Proxy>

  # Custom log file locations
  ErrorLog  /home/hfeild/online-source-code-annotator/log/ssl-error.log
  CustomLog /home/hfeild/online-source-code-annotator/log/ssl-access.log combined

</VirtualHost>


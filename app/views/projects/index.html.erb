<% provide(:title, "Projects") %>
<div id="projects-page" class="container">
  <h1>Projects</h1>



  <div class="row">

    <% [[@authoredProjects, "My Projects", "authored-projects"], 
        [@viewableProjects, "Shared for viewing", "viewer-projects"],
        [@annotatableProjects, "Shared for annotating", "annotator-projects"]].each do |data| %>
    <div class="project-set col-md-12">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title"><%= data[1] %></h3>
        </div>
        <div class="panel-body">
          <div class="list-group">
              <% if data[0].empty? and data[2] != "authored-projects" %>
                <em>No projects.</em>
              <% else %>
                <table class="table table-hover sortable-theme-bootstrap 
                    <%= data[2] %>" 
                    data-sortable>
                  <thead>
                    <th>Name</th><th>Creator</th><th>Created on</th><th></th>
                  </thead>
                  <tbody>
                    <% if data[2] == "authored-projects" %>
                    <tr id="add-project-row">
                      <td colspan="3">
                        <form id="add-project-form" >
                          <div class="input-group" style="width: 100%">
                            <span class="input-group-btn">
                              <button id="add-project-btn" 
                                class="btn btn-primary" type="submit"><span 
                                  class="glyphicon glyphicon-plus"></span
                              ></button>
                            </span>
                            <input type="text" id="new-project-name" 
                              class="form-control" 
                              placeholder="Enter a new project name...">
                          </div>
                        </form>
                      </td>
                      <td class="trash">
                        <button type="button" id="add-project-btn" 
                          class="btn btn-primary" 
                            data-toggle="modal"
                            data-target="#upload-files"
                            title="Upload/update projects with files"><span 
                            class="glyphicon glyphicon-cloud-upload"></span
                        ></button>
                      </td>
                    </tr>
                    <% end %>
                    <%= render data[0] %>
                  </tbody>
                </table>
              <% end %>
          </div>
        </div>
      </div>
    </div>
    <% end %>

  </div>
</div>


<div class="modal fade" id="upload-files" tabindex="-1" 
    role="dialog" aria-labelledby="upload-files-title">
  <div class="modal-dialog" role="document">
    <div class="modal-content">

      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" 
          aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="upload-files-title">Upload projects</h4>
      </div>
      <div class="modal-body">
        <input type="checkbox" id="batch-checkbox"> Batch upload 
        <span class="info">
        With batch upload, you can upload a zip file where every first level
        directory corresponds to a project you would like to create.
        </span><br/>

        <div id="batch-project-upload" class="hidden">
          <!-- <h4>Batch upload</h4> -->
          <!-- <form id="add-directory-form"> -->
            <%= form_for(:project, url: "/projects") do |f| %>
              <input type="hidden" name="project[batch]" value="true">
              <input type="checkbox" name="project[update]"> Update
              <span class="info">
              If update is checked, then for each first level directory in
              the zip file whose name matches up with an existing authorable
              project, the existing project will be updated. If multiple 
              authorable projects with that name exists, only one will be
              updated.
              </span><br/>
              Select one zip file to upload:
              <%= f.file_field "files", multiple: true, class: "form-control file-upload-selection" %>

         <!--      <input type="file" class="file-upload-selection"
                  name="project[files][]"/> -->
              <button type="button" 
                class="btn btn-default project-upload-submit">Upload</button>
            <% end %>
          <!-- </form> -->
        </div>

        <div id="single-project-upload">
          <!-- <h4>Add files</h4> -->
          <%= form_for(:project, url: "/projects") do |f| %>
              Project name: 
              <input type="text" name="project[name]" class="form-control project-name-input"
                placeholder="My project">
              Select one or more files to upload:
              <%= f.file_field "files", multiple: true, class: "form-control file-upload-selection" %>

              <!-- <input type="file" multiple="true" 
                  class="file-upload-selection" name="project[files][]"/> -->
              <button type="button" 
                class="btn btn-default project-upload-submit">Upload</button>
          <% end %>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" 
          data-dismiss="modal">Cancel</button>
      </div>

    </div>
  </div>
</div>


<div class="hidden">
  <table>
  <tr id="entry-template" class="clickable-row project" data-href="" 
      class="project-main">
    <td class="name"></td>
    <td class="email"></td> 
    <td class="date"></td> 
    <td class="project-trash trash">
      <span class="glyphicon glyphicon-trash"></span>
    </td>
  </tr>  
  </table>
</div>



